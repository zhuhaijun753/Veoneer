<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang xml:lang>
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>System Products Protocol / System Product Data Interfaces</title>
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    span.underline{text-decoration: underline;}
    div.column{display: inline-block; vertical-align: top; width: 50%;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
  <style type="text/css">a:link {text-decoration:none;}
a:visited {text-decoration:none;}
a:hover {text-decoration:underline;}
a:active {text-decoration:underline;}
body {
margin: auto;
padding-right: 1em;
padding-left: 1em;
padding-top: 1em;
color: black;
font-family: "ff-meta-serif-web-pro",Georgia,Cambria,"Times New Roman",Times,serif;
font-size: 100%;
line-height: 140%;
}
pre {
border: 1px dotted gray;
padding: 0.5em;
}
code {
font-family: "Courier New", monospace;
color: #a33;
}
h1 a, h2 a, h3 a, h4 a, h5 a {
text-decoration: none;
color: #001e46;
}
h1, h2, h3, h4, h5 {
font-family: 'Barlow', sans-serif;
font-weight: bold;
color: #001e46;
}
h1 {
border-bottom: 1px solid #0e2b8d;
font-size: 130%;
line-height: 140%;
page-break-before: always;
padding-top: 2em;
}
h2 {
font-size: 110%;
padding-top: 2em;
}
h3 {
font-size: 95%;
padding-top: 2em;
}
h4 {
font-size: 90%;
padding-top: 2em;
}
h5 {
font-size: 90%;
padding-top: 2em;
}
h1.title {
font-size: 200%;
font-weight: bold;
padding-top: 0.2em;
padding-bottom: 0.2em;
text-align: center;
border: none;
page-break-before: auto;
}
dt code {
font-weight: bold;
}
dd p {
margin-top: 0;
}
#nav, #confidential, #footer, figure {
font-family: 'Barlow', sans-serif;
}
#confidential {
font-size: 85%;
}
header#documentheader {
position: relative;
margin: 0;
padding: 0;
margin-left: -1em;
width: 100%;
top: 1em;
background: #ffffff;
}
div#alvheaderwrapper {
padding: 0;
margin: 0 1em;
overflow: hidden;
position: relative;
}
footer {
font-size: 75%;
border-top: 1px solid #0e2b8d;
margin-top: 1em;
}
footer#pdffooter {
display:none;
}
table {
border-collapse: collapse;
font-family: 'Barlow', sans-serif;
}
td, th {
border: 1px solid black;
margin: 0;
padding: 4px;
text-align: left;
vertical-align: top;
}
th {
color: black;
font-family: 'Barlow', sans-serif;
background-color: #c4e2df;
}
td.alvlogo {
border: none;
margin: 0;
padding: 0px;
}
table.alvheader {
margin: 0;
padding: 0;
width: 100%;
border-collapse: collapse;
}
td.alvheader {
border: 1px solid black;
margin: 0;
padding-left: 4px;
padding-right: 4px;
padding-top: 0px;
padding-bottom: 2px;
vertical-align: top;
line-height: 120%;
}
.alvmeta {
font-size: 75%;
font-style: italic;
}
td.alvheadershade {
border: 1px solid black;
margin: 0;
padding: 2px;
background-color: #c4e2df;
color: black;
line-height: 120%;
}
pre.instruction {
border: none;
color: #00c;
background-color: white;
}
.warning {
border: 4px solid red;
font-family: Verdana, sans-serif;
padding-left: 1em;
padding-right: 1em;
margin-bottom: 1em;
}
.hidden {
display: none;
}
th.left, td.left {
text-align: left;
}
th.right, td.right {
text-align: right;
}

table.memname td {
border: none;
}
.memname {
font-weight: bold;
border: none;
margin-bottom: -10px;
margin-left: 0px;
padding-left: 0px;
padding-bottom: 0px;
}
.memdoc {
margin-left: 40px;
margin-bottom: 1em;
}
table.memname td.paramname, td.paramtype {
padding-left: 0px;
padding-right: 0px;
}
td.mdescRight {
font-weight: normal;
padding-top: 0px;
margin-top: 0px;
}
</style>
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<header id="title-block-header">
<h1 class="title">System Products Protocol / System Product Data Interfaces</h1>
</header>
<nav id="TOC" role="doc-toc">
<ul>
<li><a href="#system-products-protocol-spp"><span class="toc-section-number">1</span> System Products Protocol (SPP)</a></li>
<li><a href="#way-of-working"><span class="toc-section-number">2</span> Way of working</a></li>
<li><a href="#writing-.proto-files"><span class="toc-section-number">3</span> Writing .proto files</a>
<ul>
<li><a href="#style-guide"><span class="toc-section-number">3.1</span> Style guide</a>
<ul>
<li><a href="#formatting"><span class="toc-section-number">3.1.1</span> Formatting</a></li>
<li><a href="#file-structure"><span class="toc-section-number">3.1.2</span> File structure</a></li>
<li><a href="#packages"><span class="toc-section-number">3.1.3</span> Packages</a></li>
<li><a href="#message-and-field-names"><span class="toc-section-number">3.1.4</span> Message and field names</a></li>
<li><a href="#enums"><span class="toc-section-number">3.1.5</span> Enums</a></li>
<li><a href="#services"><span class="toc-section-number">3.1.6</span> Services</a></li>
<li><a href="#summary"><span class="toc-section-number">3.1.7</span> Summary</a></li>
</ul></li>
<li><a href="#systemoptions"><span class="toc-section-number">3.2</span> SystemOptions</a>
<ul>
<li><a href="#systemfileoptions"><span class="toc-section-number">3.2.1</span> SystemFileOptions</a></li>
<li><a href="#systemmessageoptions"><span class="toc-section-number">3.2.2</span> SystemMessageOptions</a></li>
<li><a href="#systemfieldoptions"><span class="toc-section-number">3.2.3</span> SystemFieldOptions</a></li>
<li><a href="#systemenumoptions"><span class="toc-section-number">3.2.4</span> SystemEnumOptions</a></li>
</ul></li>
<li><a href="#example"><span class="toc-section-number">3.3</span> Example</a></li>
</ul></li>
<li><a href="#generating-code-and-documentation"><span class="toc-section-number">4</span> Generating code and documentation</a></li>
<li><a href="#usage"><span class="toc-section-number">5</span> Usage</a>
<ul>
<li><a href="#encoding"><span class="toc-section-number">5.1</span> Encoding</a></li>
<li><a href="#decoding"><span class="toc-section-number">5.2</span> Decoding</a></li>
</ul></li>
<li><a href="#dependencies"><span class="toc-section-number">6</span> Dependencies</a></li>
<li><a href="#installation"><span class="toc-section-number">7</span> Installation</a></li>
</ul>
</nav>
<p>This document aims to describe the data format used in System Products, how to create data interfaces as well as the process around them.</p>
<h1 data-number="1" id="system-products-protocol-spp"><span class="header-section-number">1</span> System Products Protocol (SPP)</h1>
<p>System Products Protocol data is encoded using <a href="https://developers.google.com/protocol-buffers/">Google Protocol Buffers</a> and the interfaces are defined in proto-files using proto3 syntax. Output is packaged in a <code>SystemCore.Headers.InterfaceHeader</code>, where the <code>data</code> field is populated with encoded data of the type described in the <code>dataHeader</code> field.</p>
<h1 data-number="2" id="way-of-working"><span class="header-section-number">2</span> Way of working</h1>
<p>Each area (RA, or similar) has one or two representatives in the System Products Interface Forum that can discuss and provide interface updates. If a developer see a need to update an interface (request new information from another area or supply new information) this is brought up in the Interface Forum so that all stakeholders for the interface can provide feedback. Each interface change is reviewed in Gerrit where the stakeholders should be represented. For the interface to be updated a System Products Approver needs to go through the update and the review information to make sure all considerations have been accounted for.</p>
<h1 data-number="3" id="writing-.proto-files"><span class="header-section-number">3</span> Writing .proto files</h1>
<p><a href="#systemoptions">SystemOptions</a> has some functions to simplify the reduction of datasize for the user.</p>
<p>For decimal numbers it is preferred to use <code>scale</code> in combinations with int whenever possible. In some cases however it might be better with a float since varint encoding only utilizes 7bits / byte (giving the maximum size of 10 bytes for a 64bit varint). This can be easily evaluated by specifying <a href="#vfo_min"><code>min</code></a>, <a href="#vfo_max"><code>max</code></a> and <a href="#vfo_scale"><code>scale</code></a> which will provide a <em>Max Encoded Size</em> in the generated documentation.</p>
<p>Signed integers should in most cases use sint instead of int since this get zigzag encoded thus reducing the encoded size for negative values.</p>
<p>It is possible to put messages within messages. In these cases it is only the messages that should be transmitted that needs to have <a href="#vmo_source"><code>source</code></a>, <a href="#vmo_identifier"><code>identifier</code></a>, <a href="#vmo_major_version"><code>major_version</code></a> and <a href="#vmo_minor_version"><code>minor_version</code></a>.</p>
<h2 data-number="3.1" id="style-guide"><span class="header-section-number">3.1</span> Style guide</h2>
<h3 data-number="3.1.1" id="formatting"><span class="header-section-number">3.1.1</span> Formatting</h3>
<ul>
<li>Indentation 3 spaces (Google suggests 2)</li>
<li>Line length up to 120 is ok (Google suggests 80)</li>
</ul>
<h3 data-number="3.1.2" id="file-structure"><span class="header-section-number">3.1.2</span> File structure</h3>
<ol type="1">
<li>Syntax</li>
<li>Package</li>
<li>Imports (sorted)</li>
<li>File options</li>
<li>Enums</li>
<li>Messages</li>
</ol>
<p>Messages should be in order of use, as in C. Messages containing <code>identifier</code>, meaning they are top level messages, should be placed last.</p>
<p>Google suggests a File overview in the beginning of the file. Since documentation is generated from the proto files using the SystemOptions tags we use these to document the structures instead. You are still allowed to put an overview at the start of the file if needed.</p>
<h3 data-number="3.1.3" id="packages"><span class="header-section-number">3.1.3</span> Packages</h3>
<ul>
<li>Package names should be CamelCase (Google suggests lowercase)</li>
<li>File structure and package names should be aligned e.g. files in package Zenuity.CaLong should be placed in Zenuity/CaLong/</li>
<li>It is highly recommended to sort output messages by area e.g. VisionCore.Road for Lane and RoadBoundary</li>
</ul>
<h3 data-number="3.1.4" id="message-and-field-names"><span class="header-section-number">3.1.4</span> Message and field names</h3>
<ul>
<li>Messages are written using CamelCase starting with capital letter</li>
<li>Fields are written in snake-case to support code generation using other protobuf libraries</li>
<li>Use pluralized names for repeated fields</li>
</ul>
<h3 data-number="3.1.5" id="enums"><span class="header-section-number">3.1.5</span> Enums</h3>
<ul>
<li>Use CamelCase (with an initial capital) for enum type names and CAPITALS_WITH_UNDERSCORES for value names</li>
<li>If it is important to know that no value has been set, the first value/default (0) shall be set to UNDEFINED. If the data is only used for information or if no bad effects comes from the default value the first value/default value can be set as needed. E.g. Lane marker structure, 0 = painted lane marking, 1 = Botts’ Dots. Most lanes are painted meaning that we in most cases save 2 bytes, and based on the usage of the information there should be no negative effects for the user if transmitter does not fill in the value.</li>
</ul>
<h3 data-number="3.1.6" id="services"><span class="header-section-number">3.1.6</span> Services</h3>
<p>Services are not used.</p>
<h3 data-number="3.1.7" id="summary"><span class="header-section-number">3.1.7</span> Summary</h3>
<p>In principle use Google’s <a href="https://developers.google.com/protocol-buffers/docs/style">style guide for protobuf</a> with the following exceptions:</p>
<ul>
<li>Indentation 3 spaces</li>
<li>Line length up to 120 is ok</li>
<li>Package names should be CamelCase</li>
<li>File names should be CamelCase</li>
</ul>
<h2 data-number="3.2" id="systemoptions"><span class="header-section-number">3.2</span> SystemOptions</h2>
<p>SystemOptions is an extension to enable code generation for embedded C and to simplify some data conversions by adding support functions.</p>
<p>This is a brief overview of the options. Details can be found by going through <em>SystemOptions.proto</em> as well as <em>spb_generator.py</em>.</p>
<h3 data-number="3.2.1" id="systemfileoptions"><span class="header-section-number">3.2.1</span> SystemFileOptions</h3>
<table>
<thead>
<tr class="header">
<th>Option</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>description</code></td>
<td style="text-align: left;">Description of the file used when generating documentation</td>
</tr>
</tbody>
</table>
<p>File options are accessed by adding <code>option (system_file_options).description = &quot;Description text goes here&quot;;</code> in the file.</p>
<h3 data-number="3.2.2" id="systemmessageoptions"><span class="header-section-number">3.2.2</span> SystemMessageOptions</h3>
<table>
<colgroup>
<col style="width: 15%"></col>
<col style="width: 84%"></col>
</colgroup>
<thead>
<tr class="header">
<th>Option</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code id="vmo_source">source</code></td>
<td style="text-align: left;">Describes who generated the data (MCU, Radar, Vision, Zenuity)</td>
</tr>
<tr class="even">
<td><code id="vmo_identifier">identifier</code></td>
<td style="text-align: left;">Unique number for the datasource identifying the data contained in an InterfaceHeader (see InterfaceHeader.proto, generate html documentation for a nice overview)</td>
</tr>
<tr class="odd">
<td><code id="vmo_major_version">major_version</code></td>
<td style="text-align: left;">Incremented on breaking change. Breaking changes are typically changing field meaning, removing fields, etc</td>
</tr>
<tr class="even">
<td><code id="vmo_minor_version">minor_version</code></td>
<td style="text-align: left;">Incremented for every non-major change. Indicates which information might be possible to get. A typical minor change is adding a field.</td>
</tr>
<tr class="odd">
<td><code id="vmo_patch_version">patch_version</code></td>
<td style="text-align: left;">Incremented for every patch change. Indicates file has been edited but not in a way that requires a major or minor version update. A typical patch change is restructuring the file or correcting a documentation sentence.</td>
</tr>
<tr class="even">
<td><code id="vmo_description">description</code></td>
<td style="text-align: left;">Description of the message used when generating documentation</td>
</tr>
</tbody>
</table>
<p>Message options are accessed by adding for example <code>option (system_message_options).description = &quot;Description text goes here&quot;;</code> in the message.</p>
<p><code>identifier</code> 1-9000 are reserved for Internal data messages and 9001-&gt; can be used for debug/evaluation purposes, this since the smaller number occupy less space. 1-9000 can still be sent on debug whenever evaluation of internal data is of interest. Within each <code>source</code> each <code>identifier</code> shall be unique.</p>
<h3 data-number="3.2.3" id="systemfieldoptions"><span class="header-section-number">3.2.3</span> SystemFieldOptions</h3>
<table>
<colgroup>
<col style="width: 15%"></col>
<col style="width: 84%"></col>
</colgroup>
<thead>
<tr class="header">
<th>Option</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code id="vfo_int_size">int_size</code></td>
<td style="text-align: left;">Size of integer fields. Can save some memory if you don’t need full 32 bits for the value.</td>
</tr>
<tr class="even">
<td><code id="vfo_max_size">max_size</code></td>
<td style="text-align: left;">Allocated size for static ‘bytes’ and ‘string’ fields. For string fields, this should include the space for null terminator.</td>
</tr>
<tr class="odd">
<td><code id="vfo_max_count">max_count</code></td>
<td style="text-align: left;">Allocated number of entries in arrays (‘repeated’ fields)</td>
</tr>
<tr class="even">
<td><code id="vfo_unit">unit</code></td>
<td style="text-align: left;">Unit for the data, preferably SI unit. Should regard scale.</td>
</tr>
<tr class="odd">
<td><code id="vfo_description">description</code></td>
<td style="text-align: left;">Text to describe the context of the data</td>
</tr>
<tr class="even">
<td><code id="vfo_scale">scale</code></td>
<td style="text-align: left;">Used to select scale for integer. A string is used here since we want to get correct defines in the code.</td>
</tr>
<tr class="odd">
<td><code id="vfo_users">users</code></td>
<td style="text-align: left;">Used to select users of the field to determine if field should be included in generated code. If empty all users are assumed.</td>
</tr>
<tr class="even">
<td><code id="vfo_type">type</code></td>
<td style="text-align: left;">Force type of field (static allocation or pointer to data). Pointer should basically only be used for data in the Interface Header.</td>
</tr>
<tr class="odd">
<td><code id="vfo_min">min</code></td>
<td style="text-align: left;">Min value, currently only used for documentation. Should regard scale.</td>
</tr>
<tr class="even">
<td><code id="vfo_max">max</code></td>
<td style="text-align: left;">Max value, currently only used for documentation. Should regard scale.</td>
</tr>
</tbody>
</table>
<p>Field options are accessed by adding for example <code>[(system_message_options).unit = &quot;m&quot;];</code> after the field declaration.</p>
<h3 data-number="3.2.4" id="systemenumoptions"><span class="header-section-number">3.2.4</span> SystemEnumOptions</h3>
<table>
<thead>
<tr class="header">
<th>Option</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code id="veo_description">description</code></td>
<td style="text-align: left;">Text to describe the context of the data</td>
</tr>
</tbody>
</table>
<p>Enum options are accessed by adding <code>option (system_enum_options).description = &quot;Description text goes here&quot;;</code> in the enum declaration.</p>
<h2 data-number="3.3" id="example"><span class="header-section-number">3.3</span> Example</h2>
<div class="sourceCode" id="cb1"><pre class="sourceCode proto"><code class="sourceCode protobuf"><span id="cb1-1"><a href="#cb1-1"></a>syntax = <span class="st">&quot;proto3&quot;</span>;</span>
<span id="cb1-2"><a href="#cb1-2"></a></span>
<span id="cb1-3"><a href="#cb1-3"></a><span class="kw">import</span> <span class="st">&quot;SystemOptions.proto&quot;</span>;</span>
<span id="cb1-4"><a href="#cb1-4"></a></span>
<span id="cb1-5"><a href="#cb1-5"></a><span class="kw">option</span> (system_file_options).description = <span class="st">&quot;Test description&quot;</span>;</span>
<span id="cb1-6"><a href="#cb1-6"></a></span>
<span id="cb1-7"><a href="#cb1-7"></a><span class="kw">enum</span> SomeThing</span>
<span id="cb1-8"><a href="#cb1-8"></a>{</span>
<span id="cb1-9"><a href="#cb1-9"></a>   <span class="kw">option</span> (system_enum_options).description = <span class="st">&quot;Enum description&quot;</span>;</span>
<span id="cb1-10"><a href="#cb1-10"></a>   SOME_THING_DEFAULT = <span class="dv">0</span>;</span>
<span id="cb1-11"><a href="#cb1-11"></a>   SOME_THING_ONE = <span class="dv">1</span>;</span>
<span id="cb1-12"><a href="#cb1-12"></a>}</span>
<span id="cb1-13"><a href="#cb1-13"></a></span>
<span id="cb1-14"><a href="#cb1-14"></a><span class="kw">message</span> Message</span>
<span id="cb1-15"><a href="#cb1-15"></a>{</span>
<span id="cb1-16"><a href="#cb1-16"></a>   <span class="kw">option</span> (system_message_options).source = DATA_SOURCE_MCU;</span>
<span id="cb1-17"><a href="#cb1-17"></a>   <span class="kw">option</span> (system_message_options).identifier = <span class="dv">1234</span>;</span>
<span id="cb1-18"><a href="#cb1-18"></a>   <span class="kw">option</span> (system_message_options).major_version = <span class="dv">5</span>;</span>
<span id="cb1-19"><a href="#cb1-19"></a>   <span class="kw">option</span> (system_message_options).minor_version = <span class="dv">2</span>;</span>
<span id="cb1-20"><a href="#cb1-20"></a>   <span class="kw">option</span> (system_message_options).description = <span class="st">&quot;Test is the best&quot;</span>;</span>
<span id="cb1-21"><a href="#cb1-21"></a></span>
<span id="cb1-22"><a href="#cb1-22"></a>   <span class="dt">sint32</span> speed = <span class="dv">1</span> [</span>
<span id="cb1-23"><a href="#cb1-23"></a>      (system_field_options).int_size = IS_16,</span>
<span id="cb1-24"><a href="#cb1-24"></a>      (system_field_options).unit = <span class="st">&quot;m/s&quot;</span>,</span>
<span id="cb1-25"><a href="#cb1-25"></a>      (system_field_options).scale = <span class="st">&quot;0.01&quot;</span>, <span class="co">// 1 cm/s accuracy</span></span>
<span id="cb1-26"><a href="#cb1-26"></a>      (system_field_options).description = <span class="st">&quot;Longitudinal velocity estimated in AFAC&quot;</span>,</span>
<span id="cb1-27"><a href="#cb1-27"></a>      (system_field_options).min = -<span class="dv">30</span>,</span>
<span id="cb1-28"><a href="#cb1-28"></a>      (system_field_options).max = <span class="dv">110</span></span>
<span id="cb1-29"><a href="#cb1-29"></a>   ];</span>
<span id="cb1-30"><a href="#cb1-30"></a>   SomeThing enum_thing = <span class="dv">2</span>;</span>
<span id="cb1-31"><a href="#cb1-31"></a>}</span></code></pre></div>
<h1 data-number="4" id="generating-code-and-documentation"><span class="header-section-number">4</span> Generating code and documentation</h1>
<p>Run the following command to generate source code and decumentation from your .proto file(s). All options available for the generator can be found out by providing -h/–help as argument under –spb_out.</p>
<p><code>protoc.exe --proto_path=[path to protofile] --plugin=protoc-gen-spb=[absolute path]/protoc-gen-spb.bat --spb_out=&#39;[options]&#39;:[output directory] [file.proto][ file2.proto]</code></p>
<p>To generate all interfaces run <em>generate_all_interfaces.sh</em> in the root directory. This will generate a <em>generated</em> folder containing code and documents in the root.</p>
<h1 data-number="5" id="usage"><span class="header-section-number">5</span> Usage</h1>
<p>It is recommended to use the QuickProtobuf library since it is considerably faster at the cost of code size.</p>
<h2 data-number="5.1" id="encoding"><span class="header-section-number">5.1</span> Encoding</h2>
<div class="sourceCode" id="cb2"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb2-1"><a href="#cb2-1"></a><span class="pp">#include </span><span class="im">&lt;qpb.h&gt;</span></span>
<span id="cb2-2"><a href="#cb2-2"></a><span class="pp">#include </span><span class="im">&lt;qpb_encode.h&gt;</span></span>
<span id="cb2-3"><a href="#cb2-3"></a><span class="pp">#include </span><span class="im">&lt;Message_types.qpb.h&gt;</span></span>
<span id="cb2-4"><a href="#cb2-4"></a><span class="pp">#include </span><span class="im">&lt;Message.qpb.h&gt;</span></span>
<span id="cb2-5"><a href="#cb2-5"></a></span>
<span id="cb2-6"><a href="#cb2-6"></a><span class="dt">uint8_t</span> outBuffer[Message_size] = { <span class="dv">0</span> };</span>
<span id="cb2-7"><a href="#cb2-7"></a>Message msg = { <span class="dv">0</span> };</span>
<span id="cb2-8"><a href="#cb2-8"></a></span>
<span id="cb2-9"><a href="#cb2-9"></a>msg.speed = <span class="dv">1234</span>;</span>
<span id="cb2-10"><a href="#cb2-10"></a>msg.enumThing = SOME_THING_ONE;</span>
<span id="cb2-11"><a href="#cb2-11"></a></span>
<span id="cb2-12"><a href="#cb2-12"></a>qpb_ostream_t ostream = qpb_ostream_from_buffer(outBuffer, <span class="kw">sizeof</span>(outBuffer));</span>
<span id="cb2-13"><a href="#cb2-13"></a><span class="cf">if</span> (!encode_Message(&amp;ostream, &amp;msg))</span>
<span id="cb2-14"><a href="#cb2-14"></a>{</span>
<span id="cb2-15"><a href="#cb2-15"></a>   printf(<span class="st">&quot;Encode Failed!&quot;</span>);</span>
<span id="cb2-16"><a href="#cb2-16"></a>}</span></code></pre></div>
<h2 data-number="5.2" id="decoding"><span class="header-section-number">5.2</span> Decoding</h2>
<p>The user needs to set the appropriate default values before calling the decode function, this since the decode function only sets the encoded values.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb3-1"><a href="#cb3-1"></a><span class="pp">#include </span><span class="im">&lt;qpb.h&gt;</span></span>
<span id="cb3-2"><a href="#cb3-2"></a><span class="pp">#include </span><span class="im">&lt;qpb_decode.h&gt;</span></span>
<span id="cb3-3"><a href="#cb3-3"></a><span class="pp">#include </span><span class="im">&lt;Message_types.qpb.h&gt;</span></span>
<span id="cb3-4"><a href="#cb3-4"></a><span class="pp">#include </span><span class="im">&lt;Message.qpb.h&gt;</span></span>
<span id="cb3-5"><a href="#cb3-5"></a></span>
<span id="cb3-6"><a href="#cb3-6"></a>Message msg = { <span class="dv">0</span> };</span>
<span id="cb3-7"><a href="#cb3-7"></a></span>
<span id="cb3-8"><a href="#cb3-8"></a>qpb_istream_t istream = qpb_istream_from_buffer(inBuffer, <span class="kw">sizeof</span>(inBuffer));</span>
<span id="cb3-9"><a href="#cb3-9"></a><span class="cf">if</span> (!decode_Message(&amp;istream, &amp;msg))</span>
<span id="cb3-10"><a href="#cb3-10"></a>{</span>
<span id="cb3-11"><a href="#cb3-11"></a>   printf(<span class="st">&quot;Decode Failed!&quot;</span>);</span>
<span id="cb3-12"><a href="#cb3-12"></a>}</span></code></pre></div>
<h1 data-number="6" id="dependencies"><span class="header-section-number">6</span> Dependencies</h1>
<table>
<colgroup>
<col style="width: 25%"></col>
<col style="width: 75%"></col>
</colgroup>
<thead>
<tr class="header">
<th>Tool</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>python 3</td>
<td style="text-align: left;">Symlink python3 should be available in the path (default on linux but manual step on Windows)</td>
</tr>
<tr class="even">
<td>protoc</td>
<td style="text-align: left;">Download from <a href="https://github.com/protocolbuffers/protobuf/releases">github.com/protocolbuffers/protobuf/releases</a>, to be added to artifactory or built from source</td>
</tr>
<tr class="odd">
<td>protobuf for python</td>
<td style="text-align: left;">pip install protobuf</td>
</tr>
</tbody>
</table>
<h1 data-number="7" id="installation"><span class="header-section-number">7</span> Installation</h1>
<ol type="1">
<li>Install python 3, make sure it is in the path.</li>
<li>Install protobuf python site-package, “pip install protobuf”</li>
<li>Download and place protoc in your path. Make sure to select a protoc version compatible with the python site-package.</li>
</ol>
</body>
</html>
